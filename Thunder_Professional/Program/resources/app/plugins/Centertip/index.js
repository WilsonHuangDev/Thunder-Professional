module.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){this.mThunderVersionStr=void 0,this.mThunderVersionNumber=void 0,this.mNativeCall=null,global.AsyncGetNativeCallModuleObj&&global.AsyncGetNativeCallModuleObj(e=>{this.mNativeCall=e.nativeCall,this.loadThunderVersion()})}get thunderVersionNumber(){return this.mThunderVersionNumber}get thunderVersionString(){return this.mThunderVersionStr}get clientName(){return"xl_pc"}get pluginVersion(){return"2.0"}get currentTime(){return Math.floor((new Date).getTime()/1e3)}get nativeCall(){return this.mNativeCall}loadThunderVersion(){this.mNativeCall&&this.mNativeCall.CallNativeFunction("GetThunderVersion",(e,t)=>{if(0===e){this.mThunderVersionStr=t,this.mThunderVersionNumber=0;let e=this.mThunderVersionStr.split(".");if(e&&4===e.length){let t=Number(e[0]).valueOf(),i=Number(e[1]).valueOf(),n=Number(e[2]).valueOf(),s=128;this.mThunderVersionNumber=s*Math.pow(2,24)+t*Math.pow(2,16)+i*Math.pow(2,8)+n}}})}}t.PluginHelper=n,function(e){const t=new n;e.getHelper=function(){return t}}(t.PluginHelperNS||(t.PluginHelperNS={}))},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function l(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,l)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=i(0).PluginHelperNS.getHelper();class r{constructor(){this.mPeerId=void 0,this.mUserId="0",this.mSessionId=void 0,this.mIsLogin=!1,this.mIsVip=!1,this.mVipLevel=0,this.mVasType=0}get vasType(){return this.mVasType}get vipLevel(){return this.mVipLevel}get userId(){return this.mUserId}get isLogin(){return this.mIsLogin}get isVip(){return this.mIsVip}get isPlatinumVip(){return this.isVip&&this.mVasType>2}get isSuperVip(){return this.isVip&&5===this.mVasType}getSessionId(){return n(this,void 0,void 0,function*(){return new Promise(e=>{this.mSessionId?e(this.mSessionId):s.nativeCall?s.nativeCall.CallNativeFunction("GetSessionID",(t,i)=>{0===t&&(this.mSessionId=i),e(this.mSessionId||"0")}):e(this.mSessionId||"0")})})}getPeerId(){return n(this,void 0,void 0,function*(){return new Promise(e=>{this.mPeerId?e(this.mPeerId):s.nativeCall?s.nativeCall.CallNativeFunction("GetPeerID",(t,i)=>{0===t&&i&&""!==i&&(this.mPeerId=i),e(this.mPeerId||"")}):e(this.mPeerId||"")})})}getUserinfo(){return n(this,void 0,void 0,function*(){return new Promise(e=>{let t=null;s.nativeCall?s.nativeCall.CallNativeFunction("GetAllUserInfo",(i,n)=>{0===i&&(t=n),e(t)}):e(t)})})}parseUserInfo(){return n(this,void 0,void 0,function*(){let e=yield this.getUserinfo();if(e)if(this.mIsLogin=!0,this.mUserId=e.userID||"0",e.vipList&&e.vipList[0]){if(e.vipList[0].isVip){let t=Number(e.vipList[0].isVip).valueOf();this.mIsVip=t>0}else this.mIsVip=!1;e.vipList[0].vipLevel&&(this.mVipLevel=Number(e.vipList[0].vipLevel).valueOf()),e.vipList[0].vasType&&(this.mVasType=Number(e.vipList[0].vasType).valueOf())}else this.mIsVip=!1})}onLogin(){return n(this,void 0,void 0,function*(){this.clear(),yield this.parseUserInfo()})}onLogout(){this.clear()}clear(){this.mUserId="0",this.mSessionId=void 0,this.mIsVip=!1,this.mIsLogin=!1,this.mVasType=0,this.mVipLevel=0}}t.UserHelper=r,function(e){const t=new r;e.getUserHelper=function(){return t}}(t.UserHelperNS||(t.UserHelperNS={}))},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function l(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,l)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=i(3),r=i(5),o=i(0).PluginHelperNS.getHelper(),l=i(1),a=i(9),u=l.UserHelperNS.getUserHelper();class h{constructor(){this.isWebReady=!1,this.isReported=!1,this.aidfrom=""}init(){return n(this,void 0,void 0,function*(){if(o.nativeCall){s.CneterTipStatNS.startExcPlugin(),this.attachUserEvents(),this.attachCallBackEvent(),(yield this.isLogin())&&(yield u.onLogin(),yield this.queryTip())}})}isLogin(){return n(this,void 0,void 0,function*(){return new Promise(e=>{let t=null;o.nativeCall?o.nativeCall.CallNativeFunction("IsLogined",(i,n)=>{0===i&&(t=n),e(t)}):e(t)})})}attachUserEvents(){o.nativeCall.AttachNativeEvent("onLoginSuc",()=>n(this,void 0,void 0,function*(){yield u.onLogin(),yield this.queryTip()})),o.nativeCall.AttachNativeEvent("onLogout",()=>{u.onLogout()}),o.nativeCall.AttachNativeEvent("onUserInfoChange",(e,t)=>n(this,void 0,void 0,function*(){yield this.onUserInfoChange(e,t)})),o.nativeCall.AttachNativeEvent("onLoginStatusChange",(e,t)=>{this.onLoginStatusChange(t)})}attachCallBackEvent(){o.nativeCall.CallNativeFunction("AttachCallbackEvent","CloseMiniWeb","OnCloseMiniWeb"),o.nativeCall.CallNativeFunction("AttachCallbackEvent","OpenWeb","OnOpenWeb"),o.nativeCall.CallNativeFunction("AttachCallbackEvent","ShowDlg","OnShowDlg"),o.nativeCall.AttachNativeEvent("OnCloseMiniWeb",(...e)=>{e&&e.length>0&&"x_close"===e[0]&&s.CneterTipStatNS.closeTip(this.aidfrom),o.nativeCall.CallNativeFunction("CloseTipsWnd")}),o.nativeCall.AttachNativeEvent("OnOpenWeb",(...e)=>{e&&e.length>0&&(o.nativeCall.CallNativeFunction("CloseTipsWnd"),o.nativeCall.CallNativeFunction("openNewTab",e[0]))}),o.nativeCall.AttachNativeEvent("OnShowDlg",()=>{this.isWebReady=!0,o.nativeCall.CallNativeFunction("IsMainWndShow",e=>{this.showTip(e).then().catch()})}),o.nativeCall.AttachNativeEvent("OnMainWindowVisibleChange",e=>{this.showTip(e).then().catch()})}queryTip(){return n(this,void 0,void 0,function*(){let e=new r.UserHttpSession;this.mResponse=yield e.queryTip(),this.mResponse&&0===this.mResponse.result&&this.createTip()})}reportTip(){return n(this,void 0,void 0,function*(){yield(new r.UserHttpSession).reportTip(this.mResponse.data.msgid,this.mResponse.data.reach_type)})}getCurrentDateStr(){let e=new Date,t=e.getFullYear(),i=e.getMonth(),n=e.getDate();return t.toString()+(i<10?"0"+(i+1):i+1)+(n<10?"0"+n:n)}showTip(e){return n(this,void 0,void 0,function*(){let t=yield a.ConfigHelperNS.getValue("SuspensionBubble",u.userId+"_ShowDate","0"),i=this.getCurrentDateStr();t!==i&&this.isWebReady&&(o.nativeCall.CallNativeFunction("ShowOrHideTipsWnd",e,e=>{}),!this.isReported&&e&&(this.isReported=!0,this.reportTip().then().catch(),s.CneterTipStatNS.showTip(this.aidfrom),"xufei"===this.mResponse.data.reach_type&&(yield a.ConfigHelperNS.setValue("CenterTip",u.userId+"_ShowDate",i))))})}parseUrl(e){let t=e.split("?")[1].split("&");for(let e=0;e<t.length;e++){const i=t[e],n=i.split("=")[0],s=i.split("=")[1];if("aidfrom"===n){this.aidfrom=s;break}}}createTip(){this.isReported=!1,this.isWebReady=!1;let e=this.mResponse.data.tips_content;e=(e=e+"&u_t="+u.vasType+"&c_v="+o.thunderVersionString)+"&p_v="+o.pluginVersion,this.parseUrl(e),s.CneterTipStatNS.loadTip(this.aidfrom),o.nativeCall.CallNativeFunction("CreateTipsWnd",e,!1,460,360,null)}onUserInfoChange(e,t){return n(this,void 0,void 0,function*(){"vipinfo"===e&&(yield u.parseUserInfo())})}onLoginStatusChange(e){"offline"===e&&u.onLogout()}}t.CenterTipManager=h,(new h).init().then().catch()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(4),s=i(1).UserHelperNS.getUserHelper(),r=i(0).PluginHelperNS.getHelper();!function(e){let t=r.pluginVersion,i=0,o=0;function l(){let e=0;return s.isSuperVip?e=5:s.isPlatinumVip?e=3:s.isVip&&(e=2),e}function a(){return s.vipLevel}e.startExcPlugin=function(){let e=new Map,t=function(){let e=0;return s.isLogin&&(e=1),e}(),i=function(){let e=0;return s.isVip&&(e=1),e}();e.set("is_login",t),e.set("is_vip",i),e.set("message_id","");let r={attribute1:"plug_startup_succ",extData:e};n.StatUtilitiesNS.trackEvent("xlx_vip_event",r)},e.loadTip=function(e){let s=new Map,r=l(),o=a();s.set("vip_type",r),s.set("message_id",e),s.set("viplevel",o),s.set("plugin_name","CenterTip"),s.set("plugin_version",t),i=(new Date).getTime();let u={attribute1:"center_tips_pop_load_try",extData:s};n.StatUtilitiesNS.trackEvent("xlx_vip_event",u)},e.showTip=function(e){let s=new Map,r=l(),u=a();s.set("vip_type",r),s.set("message_id",e),s.set("viplevel",u),s.set("plugin_name","CenterTip"),s.set("plugin_version",t),o=(new Date).getTime(),s.set("page_load_time",(o-i)/1e3);let h={attribute1:"center_tips_pop_load_succ",extData:s};n.StatUtilitiesNS.trackEvent("xlx_vip_event",h)},e.closeTip=function(e){let i=new Map,s=l(),r=a();i.set("vip_type",s),i.set("message_id",e),i.set("viplevel",r),i.set("plugin_name","CenterTip"),i.set("plugin_version",t),i.set("button","x"),i.set("time",((new Date).getTime()-o)/1e3);let u={attribute1:"center_tips_pop_click",extData:i};n.StatUtilitiesNS.trackEvent("xlx_vip_event",u)}}(t.CneterTipStatNS||(t.CneterTipStatNS={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0);!function(e){const t=n.PluginHelperNS.getHelper();e.trackEvent=function(e,i){if(t.nativeCall){let n=(i=i||{}).attribute1||"",s=i.attribute2||"",r=i.extData||new Map;r.set("plugin_version",t.pluginVersion);let o=function(e){let t="";return e.forEach((e,i)=>{""!==t&&(t+=","),t=t+i+"="+e}),t}(r);o=encodeURIComponent(o),t.nativeCall.CallNativeFunction("TrackEvent",e,n,s,0,0,0,0,o,(e,t)=>{})}}}(t.StatUtilitiesNS||(t.StatUtilitiesNS={}))},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function l(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,l)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),r=i(8),o=i(0).PluginHelperNS.getHelper(),l=i(1).UserHelperNS.getUserHelper();t.UserHttpSession=class extends s.HttpSession{queryTip(){return n(this,void 0,void 0,function*(){let e=l.userId,t=yield l.getSessionId();this.host="touch.vip.xunlei.com",this.retries=2,this.timeout=2e4;let i=o.thunderVersionString,n=o.thunderVersionNumber,s=yield l.getPeerId();return this.path="/xl11/touch?iver="+n+"&vfilter="+i+"&deviceid="+s,this.cookie="userid="+e+";sessionid="+t+";",new Promise(t=>{this.get(i=>{let n=null;200===i.statusCode&&i.body&&(n=r.UserHttpPackageNS.praseQueryBuffer(e,i.body)),t(n)},e=>{e.message="",t(null)})})})}reportTip(e,t){return n(this,void 0,void 0,function*(){let i=l.userId,n=yield l.getSessionId();return this.host="touch.vip.xunlei.com",this.retries=2,this.timeout=2e4,this.path="/xl11/setreaded?msgid="+e+"&reachtype="+t,this.cookie="userid="+i+";sessionid="+n+";",new Promise(e=>{this.get(t=>{let n=null;200===t.statusCode&&t.body&&(n=r.UserHttpPackageNS.praseReportBuffer(i,t.body)),e(n)},t=>{t.message="",e(null)})})})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(7);t.HttpSession=class{constructor(){this.mRetries=0,this.mHost=void 0,this.mPort=80,this.mPath=void 0,this.mAuth=void 0,this.mAccept=void 0,this.mBody=null,this.mUrl=void 0,this.mTimeout=void 0,this.mCurRetries=0,this.mCookie=void 0}get cookie(){return this.mCookie}set cookie(e){this.mCookie=e}set host(e){this.mHost=e}get host(){return this.mHost}set port(e){this.mPort=e}get port(){return this.mPort}set path(e){this.mPath=e}get path(){return this.mPath}set url(e){this.mUrl=e}get url(){return this.mUrl}set auth(e){this.mAuth=e}get auth(){return this.mAuth}set accept(e){this.mAccept=e}get accept(){return this.mAccept}set body(e){this.mBody=e}get body(){return this.mBody}set retries(e){this.mRetries=e}get retries(){return this.mRetries}set timeout(e){this.mTimeout=e}get timeout(){return this.mTimeout}post(e,t){let i=this.body;if(!i)return void t(null);let n=this.auth,s=this.accept,r={hostname:this.host,port:this.port,path:this.path||"/",method:"POST",auth:n||void 0,headers:{"Content-Length":i?i.length:0,Accept:s||"*/*"}};this.postImpl(i,r,e,i=>{this.mCurRetries<this.retries?(this.mCurRetries++,this.post(e,t)):t(i)})}get(e,t){let i={hostname:this.host,port:this.port,path:this.path||"/",method:"GET",headers:{Cookie:this.cookie}};this.getImpl(i,e,i=>{this.mCurRetries<this.retries?(this.mCurRetries++,this.get(e,t)):t(i)})}postImpl(e,t,i,s){let r=n.request(t,e=>{let t=null;e.on("data",e=>{t=t?Buffer.concat([t,e]):e}),e.on("end",()=>{i({statusCode:e.statusCode,headers:e.headers,body:t})})});r.on("error",e=>{s(e)}),r.on("timeout",()=>{r.abort()}),this.timeout&&r.setTimeout(this.timeout),r.write(e),r.end()}getImpl(e,t,i){n.get(e,e=>{let i=null;e.on("data",e=>{i=i?Buffer.concat([i,e]):e}),e.on("end",()=>{t({statusCode:e.statusCode,headers:e.headers,body:i})})}).on("error",e=>{i(e)})}}},function(e,t){e.exports=require("http")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.praseQueryBuffer=function(e,t){if(!t)return null;let i=t.toString(),n=JSON.parse(i);if(!n)return null;let s=n.data?n.data.touches:null,r=null;if(s&&s.length>0){let e=s[0];r={result:n.result,msg:n.msg,data:e}}return r},e.praseReportBuffer=function(e,t){if(!t)return null;let i=t.toString(),n=JSON.parse(i);return{result:n.result,msg:n.msg}}}(t.UserHttpPackageNS||(t.UserHttpPackageNS={}))},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function l(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,l)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=i(0).PluginHelperNS.getHelper();!function(e){e.getValue=function(e,t,i){return n(this,void 0,void 0,function*(){return new Promise(n=>{s.nativeCall.CallNativeFunction("GetConfigValue",e,t,i,(e,t)=>{n(0===e?t:i)})})})},e.setValue=function(e,t,i){return n(this,void 0,void 0,function*(){return new Promise((n,r)=>{s.nativeCall.CallNativeFunction("SetConfigValue",e,t,i,e=>{0===e?n():r(new Error("SetConfigValue error"))})})})}}(t.ConfigHelperNS||(t.ConfigHelperNS={}))}]);
//# sourceMappingURL=index.js.map